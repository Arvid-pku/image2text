(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&e(o)}).observe(document,{childList:!0,subtree:!0});function s(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function e(i){if(i.ep)return;i.ep=!0;const n=s(i);fetch(i.href,n)}})();const m=[{char:"█",weight:1},{char:"▓",weight:.9},{char:"▒",weight:.75},{char:"░",weight:.6},{char:"▄",weight:.55},{char:"▀",weight:.55},{char:"■",weight:.5},{char:"●",weight:.45},{char:"◐",weight:.4},{char:"#",weight:.38},{char:"@",weight:.35},{char:"%",weight:.32},{char:"&",weight:.3},{char:"*",weight:.25},{char:"+",weight:.2},{char:"=",weight:.18},{char:"~",weight:.15},{char:"-",weight:.12},{char:":",weight:.1},{char:";",weight:.08},{char:"'",weight:.06},{char:'"',weight:.05},{char:".",weight:.03},{char:" ",weight:0}];function E(a){const t=1-a/255;let s=m[0],e=Math.abs(t-s.weight);for(const i of m){const n=Math.abs(t-i.weight);n<e&&(e=n,s=i)}return s}function S(a){const t=m.findIndex(e=>e.char===a);if(t===-1)return[a];const s=[m[t].char];return t>0&&s.push(m[t-1].char),t<m.length-1&&s.push(m[t+1].char),s}function R(a,t=100){const{width:s,height:e,data:i}=a,n=s/t,o=n*2,c=Math.floor(e/o),l=[];for(let g=0;g<c;g++)for(let h=0;h<t;h++){const f=Math.floor(h*n+n/2),p=(Math.floor(g*o+o/2)*s+f)*4,v=i[p],w=i[p+1],x=i[p+2],T=.299*v+.587*w+.114*x,M=E(T);l.push({char:M.char,weight:M.weight,col:h,row:g,originalColor:`rgb(${v}, ${w}, ${x})`})}return{characters:l,cols:t,rows:c}}function X(a){return new Promise((t,s)=>{const e=new Image,i=URL.createObjectURL(a);e.onload=()=>{const n=document.createElement("canvas");n.width=e.width,n.height=e.height;const o=n.getContext("2d");o.drawImage(e,0,0);const c=o.getImageData(0,0,e.width,e.height);URL.revokeObjectURL(i),t(c)},e.onerror=()=>{URL.revokeObjectURL(i),s(new Error("Failed to load image"))},e.src=i})}class Y{constructor({char:t,weight:s,col:e,row:i,originalColor:n,charWidth:o,charHeight:c}){this.char=t,this.originalChar=t,this.weight=s,this.col=e,this.row=i,this.x=e*o,this.y=i*c,this.targetX=this.x,this.targetY=this.y,this.vx=0,this.vy=0,this.color="#1a1a1a",this.originalColor=n,this.scale=1,this.targetScale=1,this.opacity=1,this.disturbed=!1,this.disturbTime=0}update(t,s=.1){this.x+=(this.targetX-this.x)*s,this.y+=(this.targetY-this.y)*s,this.x+=this.vx*t,this.y+=this.vy*t,this.vx*=.95,this.vy*=.95,this.scale+=(this.targetScale-this.scale)*s,this.disturbed&&(this.disturbTime+=t,this.disturbTime>1e3&&(this.disturbed=!1,this.disturbTime=0))}reset(){this.targetX=this.col*this.charWidth,this.targetY=this.row*this.charHeight,this.char=this.originalChar,this.vx=0,this.vy=0,this.scale=1,this.targetScale=1}draw(t,s,e,i=!1){t.save();const n=this.x+s/2,o=this.y+e/2;t.translate(n,o),t.scale(this.scale,this.scale),t.fillStyle=i?this.originalColor:this.color,t.globalAlpha=this.opacity,t.textAlign="center",t.textBaseline="middle",t.fillText(this.char,0,0),t.restore()}}class A{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.characters=[],this.cols=0,this.rows=0,this.charWidth=10,this.charHeight=18,this.colorMode=!1,this.font='14px "IBM Plex Mono"'}setAsciiData({characters:t,cols:s,rows:e}){this.cols=s,this.rows=e,this.charWidth=this.canvas.width/s,this.charHeight=this.canvas.height/e,this.characters=t.map(i=>new Y({...i,charWidth:this.charWidth,charHeight:this.charHeight}))}resize(t,s){this.canvas.width=t,this.canvas.height=s,this.cols>0&&(this.charWidth=t/this.cols,this.charHeight=s/this.rows,this.characters.forEach(e=>{e.targetX=e.col*this.charWidth,e.targetY=e.row*this.charHeight,e.x=e.targetX,e.y=e.targetY}))}update(t){this.characters.forEach(s=>s.update(t))}draw(){const{ctx:t,canvas:s,charWidth:e,charHeight:i,colorMode:n}=this;t.fillStyle="#fff",t.fillRect(0,0,s.width,s.height),t.font=this.font,this.characters.forEach(o=>{o.draw(t,e,i,n)})}getCharacterAt(t,s){const e=Math.floor(t/this.charWidth),n=Math.floor(s/this.charHeight)*this.cols+e;return this.characters[n]||null}getCharactersInRadius(t,s,e){return this.characters.filter(i=>{const n=i.x+this.charWidth/2,o=i.y+this.charHeight/2;return Math.sqrt((n-t)**2+(o-s)**2)<=e})}}class L{constructor(){this.time=0,this.active=!0}update(t,s){this.active&&(this.time+=s*.001,t.forEach((e,i)=>{const n=(e.col+e.row)*.1,o=Math.sin(this.time*.5+n);if(Math.random()<.001&&Math.abs(o)>.8){const l=S(e.originalChar);e.char=l[Math.floor(Math.random()*l.length)]}const c=1+Math.sin(this.time*.3+n)*.02;e.disturbed||(e.targetScale=c)}))}}class H{constructor(){this.active=!0,this.mouseX=0,this.mouseY=0,this.prevMouseX=0,this.prevMouseY=0,this.mouseSpeed=0,this.radius=80}setMousePosition(t,s){this.prevMouseX=this.mouseX,this.prevMouseY=this.mouseY,this.mouseX=t,this.mouseY=s;const e=t-this.prevMouseX,i=s-this.prevMouseY;this.mouseSpeed=Math.sqrt(e*e+i*i)}update(t,s,e,i){if(!this.active)return;const n=this.radius+this.mouseSpeed*.5,o=.3+this.mouseSpeed*.02;t.forEach(c=>{const l=c.col*e+e/2,g=c.row*i+i/2,h=l-this.mouseX,f=g-this.mouseY,u=Math.sqrt(h*h+f*f);if(u<n&&u>0){const p=(1-u/n)*o,v=Math.atan2(f,h);c.targetX=c.col*e+Math.cos(v)*p*e,c.targetY=c.row*i+Math.sin(v)*p*i,c.disturbed=!0,c.disturbTime=0}else c.disturbed||(c.targetX=c.col*e,c.targetY=c.row*i)})}}class G{constructor(){this.active=!0,this.glitchRadius=60,this.glitchDuration=300,this.activeGlitches=[]}trigger(t,s){this.active&&this.activeGlitches.push({x:t,y:s,startTime:performance.now()})}update(t,s,e,i,n){this.active&&(this.activeGlitches=this.activeGlitches.filter(o=>{const c=n-o.startTime;if(c>this.glitchDuration)return t.forEach(h=>{const f=h.col*e+e/2,u=h.row*i+i/2;Math.sqrt((f-o.x)**2+(u-o.y)**2)<this.glitchRadius&&(h.char=h.originalChar)}),!1;const g=1-c/this.glitchDuration;return t.forEach(h=>{const f=h.col*e+e/2,u=h.row*i+i/2;if(Math.sqrt((f-o.x)**2+(u-o.y)**2)<this.glitchRadius){if(Math.random()<g*.3){const v=Math.floor(Math.random()*m.length);h.char=m[v].char}h.targetX=h.col*e+(Math.random()-.5)*g*10,h.targetY=h.row*i+(Math.random()-.5)*g*10,h.disturbed=!0,h.disturbTime=0}}),!0}))}}class I{constructor(){this.active=!0,this.isDragging=!1,this.dragX=0,this.dragY=0,this.prevDragX=0,this.prevDragY=0,this.smearRadius=50,this.smearStrength=.8}startDrag(t,s){this.active&&(this.isDragging=!0,this.dragX=t,this.dragY=s,this.prevDragX=t,this.prevDragY=s)}moveDrag(t,s){!this.active||!this.isDragging||(this.prevDragX=this.dragX,this.prevDragY=this.dragY,this.dragX=t,this.dragY=s)}endDrag(){this.isDragging=!1}update(t,s,e,i){if(!this.active||!this.isDragging)return;const n=this.dragX-this.prevDragX,o=this.dragY-this.prevDragY;Math.sqrt(n*n+o*o)<1||t.forEach(l=>{const g=l.col*e+e/2,h=l.row*i+i/2,f=Math.sqrt((g-this.dragX)**2+(h-this.dragY)**2);if(f<this.smearRadius){const u=(1-f/this.smearRadius)*this.smearStrength;l.vx+=n*u*.5,l.vy+=o*u*.5,l.disturbed=!0,l.disturbTime=0}})}}class B{constructor(){this.active=!1,this.idleTime=0,this.idleThreshold=6e4,this.driftStrength=0,this.maxDrift=.5}recordActivity(){this.idleTime=0,this.driftStrength=Math.max(0,this.driftStrength-.01)}update(t,s,e,i){if(!this.active){this.driftStrength=0;return}this.idleTime+=s,this.idleTime>this.idleThreshold&&(this.driftStrength=Math.min(this.maxDrift,this.driftStrength+s*1e-5)),!(this.driftStrength<.01)&&t.forEach(n=>{if(Math.random()<.01*this.driftStrength){const o=Math.random()*Math.PI*2,c=Math.random()*e*this.driftStrength*2;n.targetX=n.col*e+Math.cos(o)*c,n.targetY=n.row*i+Math.sin(o)*c}})}}class k{constructor(){this.state={hasHovered:!1,hasClicked:!1,hasDragged:!1,completed:!1},this.onComplete=null}recordHover(){this.state.hasHovered||(this.state.hasHovered=!0,this.checkComplete())}recordClick(){this.state.hasClicked||(this.state.hasClicked=!0,this.checkComplete())}recordDrag(){this.state.hasDragged||(this.state.hasDragged=!0,this.checkComplete())}checkComplete(){this.state.hasHovered&&this.state.hasClicked&&this.state.hasDragged&&(this.state.completed=!0,this.onComplete&&this.onComplete())}getNextHint(){return this.state.hasHovered?this.state.hasClicked?this.state.hasDragged?null:"drag across the canvas":"try clicking":"move your cursor over the art"}}class q{constructor(){this.element=document.createElement("div"),this.element.className="hint",this.element.style.opacity="0",document.getElementById("app").appendChild(this.element),this.currentHint=null,this.hideTimeout=null}show(t){t!==this.currentHint&&(this.currentHint=t,this.element.textContent=t,this.element.style.opacity="1",clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>this.hide(),4e3))}hide(){this.element.style.opacity="0",this.currentHint=null}destroy(){this.element.remove()}}class P{constructor(){this.element=document.createElement("div"),this.element.className="mode-selector",this.element.innerHTML=`
      <div class="modes">
        <span class="mode active" data-mode="ripple">Ripple</span>
        <span class="mode" data-mode="glitch">Glitch</span>
        <span class="mode" data-mode="smear">Smear</span>
        <span class="mode" data-mode="chaos">Chaos</span>
      </div>
      <div class="toggles">
        <span class="toggle" data-toggle="sound">Sound</span>
        <span class="toggle" data-toggle="color">Color</span>
        <span class="toggle" data-toggle="drift">Drift</span>
      </div>
    `,this.element.style.opacity="0",this.element.style.pointerEvents="none",document.getElementById("app").appendChild(this.element),this.currentMode="ripple",this.toggles={sound:!1,color:!1,drift:!1},this.onModeChange=null,this.onToggleChange=null,this.bindEvents()}bindEvents(){this.element.querySelectorAll(".mode").forEach(t=>{t.addEventListener("click",()=>{this.setMode(t.dataset.mode)})}),this.element.querySelectorAll(".toggle").forEach(t=>{t.addEventListener("click",()=>{this.setToggle(t.dataset.toggle,!this.toggles[t.dataset.toggle])})})}setMode(t){this.currentMode=t,this.element.querySelectorAll(".mode").forEach(s=>{s.classList.toggle("active",s.dataset.mode===t)}),this.onModeChange&&this.onModeChange(t)}setToggle(t,s){this.toggles[t]=s,this.element.querySelector(`[data-toggle="${t}"]`).classList.toggle("active",s),this.onToggleChange&&this.onToggleChange(t,s)}show(){this.element.style.opacity="1",this.element.style.pointerEvents="auto"}hide(){this.element.style.opacity="0",this.element.style.pointerEvents="none"}}class O{constructor(){this.ctx=null,this.masterGain=null,this.enabled=!1,this.initialized=!1}async init(){this.initialized||(this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.connect(this.ctx.destination),this.masterGain.gain.value=0,this.initialized=!0)}enable(){this.initialized||this.init(),this.enabled=!0,this.masterGain.gain.linearRampToValueAtTime(.3,this.ctx.currentTime+2)}disable(){this.enabled=!1,this.masterGain&&this.masterGain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.5)}playRipple(t){if(!this.enabled||!this.ctx)return;const s=this.ctx.createOscillator(),e=this.ctx.createGain();s.type="sine",s.frequency.value=200+t*2,e.gain.value=.1,e.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.3),s.connect(e),e.connect(this.masterGain),s.start(),s.stop(this.ctx.currentTime+.3)}playGlitch(){if(!this.enabled||!this.ctx)return;const t=this.ctx.sampleRate*.1,s=this.ctx.createBuffer(1,t,this.ctx.sampleRate),e=s.getChannelData(0);for(let o=0;o<t;o++)e[o]=(Math.random()*2-1)*.3;const i=this.ctx.createBufferSource(),n=this.ctx.createGain();i.buffer=s,n.gain.value=.15,n.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.1),i.connect(n),n.connect(this.masterGain),i.start()}playSmear(t,s){if(!this.enabled||!this.ctx)return;const e=this.ctx.createOscillator(),i=this.ctx.createGain();e.type="triangle";const n=150;e.frequency.value=n+s*.5,i.gain.value=.08,i.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.2),e.connect(i),i.connect(this.masterGain),e.start(),e.stop(this.ctx.currentTime+.2)}}const d=document.getElementById("canvas"),C=document.getElementById("upload"),z=document.getElementById("upload-btn"),r={renderer:new A(d),lastTime:0,running:!1,effects:{breathing:new L,ripple:new H,glitch:new G,smear:new I,drift:new B},discovery:new k,hints:new q,modeSelector:new P,sound:new O};r.discovery.onComplete=()=>{r.hints.hide(),r.modeSelector.show()};r.modeSelector.onModeChange=a=>{r.effects.ripple.active=!1,r.effects.glitch.active=!1,r.effects.smear.active=!1,(a==="ripple"||a==="chaos")&&(r.effects.ripple.active=!0),(a==="glitch"||a==="chaos")&&(r.effects.glitch.active=!0),(a==="smear"||a==="chaos")&&(r.effects.smear.active=!0)};r.modeSelector.onToggleChange=(a,t)=>{a==="color"&&(r.renderer.colorMode=t),a==="sound"&&(t?r.sound.enable():r.sound.disable()),a==="drift"&&(r.effects.drift.active=t)};function y(){const a=window.innerWidth*.85,t=window.innerHeight*.85,s=r.renderer.cols>0?r.renderer.cols*10/(r.renderer.rows*18):4/3;let e=a,i=e/s;i>t&&(i=t,e=i*s),r.renderer.resize(e,i)}function D(a){if(!r.running)return;const t=a-r.lastTime;if(r.lastTime=a,r.effects.breathing.update(r.renderer.characters,t),r.effects.ripple.update(r.renderer.characters,t,r.renderer.charWidth,r.renderer.charHeight),r.effects.glitch.update(r.renderer.characters,t,r.renderer.charWidth,r.renderer.charHeight,a),r.effects.smear.update(r.renderer.characters,t,r.renderer.charWidth,r.renderer.charHeight),r.effects.drift.update(r.renderer.characters,t,r.renderer.charWidth,r.renderer.charHeight),!r.discovery.state.completed){const s=r.discovery.getNextHint();s&&r.hints.show(s)}r.renderer.update(t),r.renderer.draw(),requestAnimationFrame(D)}async function b(a){try{const t=await X(a),s=R(t,100);r.renderer.setAsciiData(s),y(),r.running||(r.running=!0,r.lastTime=performance.now(),requestAnimationFrame(D))}catch(t){console.error("Failed to process image:",t)}}d.addEventListener("mousemove",a=>{const t=d.getBoundingClientRect(),s=a.clientX-t.left,e=a.clientY-t.top;if(r.effects.ripple.setMousePosition(s,e),r.effects.smear.moveDrag(s,e),r.discovery.recordHover(),r.effects.drift.recordActivity(),r.effects.ripple.active&&r.effects.ripple.mouseSpeed>5&&r.sound.playRipple(r.effects.ripple.mouseSpeed),r.effects.smear.isDragging){const i=r.effects.smear.dragX-r.effects.smear.prevDragX,n=r.effects.smear.dragY-r.effects.smear.prevDragY;r.sound.playSmear(i,n)}});d.addEventListener("mousedown",a=>{const t=d.getBoundingClientRect(),s=a.clientX-t.left,e=a.clientY-t.top;r.effects.smear.startDrag(s,e),r.discovery.recordDrag()});d.addEventListener("mouseup",()=>{r.effects.smear.endDrag()});d.addEventListener("mouseleave",()=>{r.effects.smear.endDrag()});d.addEventListener("click",a=>{const t=d.getBoundingClientRect(),s=a.clientX-t.left,e=a.clientY-t.top;r.effects.glitch.trigger(s,e),r.sound.playGlitch(),r.discovery.recordClick(),r.effects.drift.recordActivity()});d.addEventListener("touchstart",a=>{a.preventDefault();const t=a.touches[0],s=d.getBoundingClientRect(),e=t.clientX-s.left,i=t.clientY-s.top;r.effects.smear.startDrag(e,i),r.effects.ripple.setMousePosition(e,i),r.discovery.recordHover()});d.addEventListener("touchmove",a=>{a.preventDefault();const t=a.touches[0],s=d.getBoundingClientRect(),e=t.clientX-s.left,i=t.clientY-s.top;r.effects.ripple.setMousePosition(e,i),r.effects.smear.moveDrag(e,i),r.effects.drift.recordActivity(),r.discovery.recordDrag()});d.addEventListener("touchend",a=>{if(a.preventDefault(),r.effects.smear.endDrag(),a.changedTouches.length===1){const t=a.changedTouches[0],s=d.getBoundingClientRect(),e=t.clientX-s.left,i=t.clientY-s.top;r.effects.glitch.trigger(e,i),r.sound.playGlitch(),r.discovery.recordClick()}});z.addEventListener("click",()=>C.click());C.addEventListener("change",a=>{const t=a.target.files[0];t&&b(t)});window.addEventListener("resize",y);y();console.log("ASCII Art Installation ready");async function N(){try{const a=await fetch("/example.jpg");if(!a.ok)throw new Error("No example image");const t=await a.blob(),s=new File([t],"example.jpg",{type:"image/jpeg"});await b(s)}catch{console.log("No example image found, waiting for upload")}}N();
