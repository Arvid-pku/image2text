(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))e(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}})();const E=[{char:"█",weight:1},{char:"▓",weight:.9},{char:"▒",weight:.75},{char:"░",weight:.6},{char:"▄",weight:.55},{char:"▀",weight:.55},{char:"■",weight:.5},{char:"●",weight:.45},{char:"◐",weight:.4},{char:"#",weight:.38},{char:"@",weight:.35},{char:"%",weight:.32},{char:"&",weight:.3},{char:"*",weight:.25},{char:"+",weight:.2},{char:"=",weight:.18},{char:"~",weight:.15},{char:"-",weight:.12},{char:":",weight:.1},{char:";",weight:.08},{char:"'",weight:.06},{char:'"',weight:.05},{char:".",weight:.03},{char:" ",weight:0}],I=[{char:"@",weight:1},{char:"%",weight:.95},{char:"#",weight:.9},{char:"M",weight:.85},{char:"W",weight:.82},{char:"N",weight:.78},{char:"B",weight:.75},{char:"Q",weight:.72},{char:"O",weight:.68},{char:"D",weight:.65},{char:"K",weight:.62},{char:"X",weight:.58},{char:"Y",weight:.55},{char:"Z",weight:.52},{char:"m",weight:.48},{char:"w",weight:.45},{char:"q",weight:.42},{char:"p",weight:.4},{char:"d",weight:.38},{char:"b",weight:.36},{char:"k",weight:.34},{char:"h",weight:.32},{char:"a",weight:.3},{char:"o",weight:.28},{char:"e",weight:.26},{char:"c",weight:.24},{char:"z",weight:.22},{char:"u",weight:.2},{char:"n",weight:.18},{char:"x",weight:.16},{char:"j",weight:.14},{char:"f",weight:.12},{char:"t",weight:.1},{char:"|",weight:.09},{char:"(",weight:.08},{char:")",weight:.08},{char:"[",weight:.07},{char:"]",weight:.07},{char:"{",weight:.06},{char:"}",weight:.06},{char:"!",weight:.05},{char:"?",weight:.05},{char:"/",weight:.04},{char:"\\",weight:.04},{char:";",weight:.03},{char:":",weight:.03},{char:",",weight:.02},{char:"'",weight:.02},{char:".",weight:.01},{char:" ",weight:0}];function k(n,t){let s=t[0],e=Math.abs(n-s.weight);for(const r of t){const a=Math.abs(n-r.weight);a<e&&(e=a,s=r)}return s.char}let x=E;function B(n){x=n}function H(n){return n==="ascii"?I:E}const A=E;function O(n){const t=1-n/255;let s=x[0],e=Math.abs(t-s.weight);for(const r of x){const a=Math.abs(t-r.weight);a<e&&(e=a,s=r)}return s}function P(n){const t=x.findIndex(e=>e.char===n);if(t===-1)return[n];const s=[x[t].char];return t>0&&s.push(x[t-1].char),t<x.length-1&&s.push(x[t+1].char),s}function F(n,t=100){const{width:s,height:e,data:r}=n,a=s/t,c=a*2,o=Math.floor(e/c),h=[];for(let d=0;d<o;d++)for(let l=0;l<t;l++){const u=Math.floor(l*a+a/2),g=(Math.floor(d*c+c/2)*s+u)*4,p=r[g],w=r[g+1],v=r[g+2],y=.299*p+.587*w+.114*v,M=O(y);h.push({char:M.char,weight:M.weight,col:l,row:d,originalColor:`rgb(${p}, ${w}, ${v})`})}return{characters:h,cols:t,rows:o}}function U(n){return new Promise((t,s)=>{const e=new Image,r=URL.createObjectURL(n);e.onload=()=>{const a=document.createElement("canvas");a.width=e.width,a.height=e.height;const c=a.getContext("2d");c.drawImage(e,0,0);const o=c.getImageData(0,0,e.width,e.height);URL.revokeObjectURL(r),t(o)},e.onerror=()=>{URL.revokeObjectURL(r),s(new Error("Failed to load image"))},e.src=r})}class z{constructor({char:t,weight:s,col:e,row:r,originalColor:a,charWidth:c,charHeight:o}){this.char=t,this.originalChar=t,this.weight=s,this.col=e,this.row=r,this.x=e*c,this.y=r*o,this.targetX=this.x,this.targetY=this.y,this.vx=0,this.vy=0,this.color="#1a1a1a",this.originalColor=a,this.scale=1,this.targetScale=1,this.opacity=1,this.disturbed=!1,this.disturbTime=0}update(t,s=.1){this.x+=(this.targetX-this.x)*s,this.y+=(this.targetY-this.y)*s,this.x+=this.vx*t,this.y+=this.vy*t,this.vx*=.95,this.vy*=.95,this.scale+=(this.targetScale-this.scale)*s,this.disturbed&&(this.disturbTime+=t,this.disturbTime>1e3&&(this.disturbed=!1,this.disturbTime=0))}reset(){this.targetX=this.col*this.charWidth,this.targetY=this.row*this.charHeight,this.char=this.originalChar,this.vx=0,this.vy=0,this.scale=1,this.targetScale=1}draw(t,s,e,r=!1){t.save();const a=this.x+s/2,c=this.y+e/2;t.translate(a,c),t.scale(this.scale,this.scale),t.fillStyle=r?this.originalColor:this.color,t.globalAlpha=this.opacity,t.textAlign="center",t.textBaseline="middle",t.fillText(this.char,0,0),t.restore()}}class V{constructor(t){this.canvas=t,this.ctx=t.getContext("2d"),this.characters=[],this.cols=0,this.rows=0,this.charWidth=10,this.charHeight=18,this.colorMode=!1,this.font='14px "IBM Plex Mono"'}setAsciiData({characters:t,cols:s,rows:e}){this.cols=s,this.rows=e,this.charWidth=this.canvas.width/s,this.charHeight=this.canvas.height/e,this.updateFont(),this.characters=t.map(r=>new z({...r,charWidth:this.charWidth,charHeight:this.charHeight}))}updateFont(){const t=Math.floor(this.charHeight*.85);this.font=`${t}px "IBM Plex Mono"`}resize(t,s){this.canvas.width=t,this.canvas.height=s,this.cols>0&&(this.charWidth=t/this.cols,this.charHeight=s/this.rows,this.updateFont(),this.characters.forEach(e=>{e.targetX=e.col*this.charWidth,e.targetY=e.row*this.charHeight,e.x=e.targetX,e.y=e.targetY}))}update(t){this.characters.forEach(s=>s.update(t))}draw(){const{ctx:t,canvas:s,charWidth:e,charHeight:r,colorMode:a}=this;t.fillStyle="#fff",t.fillRect(0,0,s.width,s.height),t.font=this.font,this.characters.forEach(c=>{c.draw(t,e,r,a)})}getCharacterAt(t,s){const e=Math.floor(t/this.charWidth),a=Math.floor(s/this.charHeight)*this.cols+e;return this.characters[a]||null}getCharactersInRadius(t,s,e){return this.characters.filter(r=>{const a=r.x+this.charWidth/2,c=r.y+this.charHeight/2;return Math.sqrt((a-t)**2+(c-s)**2)<=e})}pulse(){const t=this.cols/2,s=this.rows/2;this.characters.forEach(e=>{const a=Math.sqrt((e.col-t)**2+(e.row-s)**2)*20;setTimeout(()=>{e.targetScale=1.3,setTimeout(()=>{e.targetScale=1},150)},a)})}charsetMode=!0;transitionCharset(t){if(this.charsetMode===t)return;this.charsetMode=t;const s=t?E:I,e=5;this.characters.forEach((r,a)=>{const c=r.col,o=r.row,h=(c+o*.5)*e;setTimeout(()=>{const l=r.opacity,u=f=>{const g=Math.min(f/100,1);if(r.opacity=l*(1-g),g<1)requestAnimationFrame(p=>u(f+16));else{const p=k(r.weight,s);r.char=p,r.originalChar=p;const w=v=>{const y=Math.min(v/100,1);r.opacity=y,y<1&&requestAnimationFrame(M=>w(v+16))};w(0)}};u(0)},h)})}exportAsPNG(){const s=document.createElement("canvas");s.width=this.canvas.width*2,s.height=this.canvas.height*2;const e=s.getContext("2d");e.scale(2,2),e.fillStyle="#fff",e.fillRect(0,0,this.canvas.width,this.canvas.height),e.font=this.font,this.characters.forEach(c=>{c.draw(e,this.charWidth,this.charHeight,this.colorMode)});const r=s.toDataURL("image/png"),a=document.createElement("a");a.download=`ascii-art-${Date.now()}.png`,a.href=r,a.click()}exportAsText(){const t=[];for(let c=0;c<this.rows;c++){let o="";for(let h=0;h<this.cols;h++){const d=c*this.cols+h,l=this.characters[d];o+=l?l.char:" "}t.push(o.trimEnd())}for(;t.length>0&&t[t.length-1]==="";)t.pop();const s=t.join(`
`),e=new Blob([s],{type:"text/plain"}),r=URL.createObjectURL(e),a=document.createElement("a");a.download=`ascii-art-${Date.now()}.txt`,a.href=r,a.click(),URL.revokeObjectURL(r)}}class j{constructor(){this.time=0,this.active=!0}update(t,s){this.active&&(this.time+=s*.001,t.forEach((e,r)=>{const a=(e.col+e.row)*.1,c=(e.col*.7-e.row*.3)*.15,o=Math.sin(this.time*.5+a),h=Math.sin(this.time*.3+c),d=(o+h)/2;if(Math.random()<.005&&Math.abs(d)>.6){const u=P(e.originalChar);e.char=u[Math.floor(Math.random()*u.length)]}const l=1+d*.05;e.disturbed||(e.targetScale=l,e.opacity=.85+d*.15)}))}}class W{constructor(){this.active=!0,this.intensity=1,this.mouseX=0,this.mouseY=0,this.prevMouseX=0,this.prevMouseY=0,this.mouseSpeed=0,this.radius=80}setMousePosition(t,s){this.prevMouseX=this.mouseX,this.prevMouseY=this.mouseY,this.mouseX=t,this.mouseY=s;const e=t-this.prevMouseX,r=s-this.prevMouseY;this.mouseSpeed=Math.sqrt(e*e+r*r)}update(t,s,e,r){if(!this.active)return;const a=(this.radius+this.mouseSpeed*.5)*this.intensity,c=(.3+this.mouseSpeed*.02)*this.intensity;t.forEach(o=>{const h=o.col*e+e/2,d=o.row*r+r/2,l=h-this.mouseX,u=d-this.mouseY,f=Math.sqrt(l*l+u*u);if(f<a&&f>0){const g=(1-f/a)*c,p=Math.atan2(u,l);o.targetX=o.col*e+Math.cos(p)*g*e,o.targetY=o.row*r+Math.sin(p)*g*r,o.disturbed=!0,o.disturbTime=0}else o.disturbed||(o.targetX=o.col*e,o.targetY=o.row*r)})}}class ${constructor(){this.active=!0,this.intensity=1,this.glitchRadius=60,this.glitchDuration=300,this.activeGlitches=[]}trigger(t,s){this.active&&this.activeGlitches.push({x:t,y:s,startTime:performance.now()})}update(t,s,e,r,a){this.active&&(this.activeGlitches=this.activeGlitches.filter(c=>{const o=a-c.startTime;if(o>this.glitchDuration)return t.forEach(l=>{const u=l.col*e+e/2,f=l.row*r+r/2;Math.sqrt((u-c.x)**2+(f-c.y)**2)<this.glitchRadius&&(l.char=l.originalChar)}),!1;const d=(1-o/this.glitchDuration)*this.intensity;return t.forEach(l=>{const u=l.col*e+e/2,f=l.row*r+r/2;if(Math.sqrt((u-c.x)**2+(f-c.y)**2)<this.glitchRadius){if(Math.random()<d*.3){const p=Math.floor(Math.random()*A.length);l.char=A[p].char}l.targetX=l.col*e+(Math.random()-.5)*d*10,l.targetY=l.row*r+(Math.random()-.5)*d*10,l.disturbed=!0,l.disturbTime=0}}),!0}))}}class Q{constructor(){this.active=!0,this.intensity=1,this.isDragging=!1,this.dragX=0,this.dragY=0,this.prevDragX=0,this.prevDragY=0,this.smearRadius=50,this.smearStrength=.8}startDrag(t,s){this.active&&(this.isDragging=!0,this.dragX=t,this.dragY=s,this.prevDragX=t,this.prevDragY=s)}moveDrag(t,s){!this.active||!this.isDragging||(this.prevDragX=this.dragX,this.prevDragY=this.dragY,this.dragX=t,this.dragY=s)}endDrag(){this.isDragging=!1}update(t,s,e,r){if(!this.active||!this.isDragging)return;const a=this.dragX-this.prevDragX,c=this.dragY-this.prevDragY;Math.sqrt(a*a+c*c)<1||t.forEach(h=>{const d=h.col*e+e/2,l=h.row*r+r/2,u=Math.sqrt((d-this.dragX)**2+(l-this.dragY)**2);if(u<this.smearRadius*this.intensity){const f=(1-u/(this.smearRadius*this.intensity))*this.smearStrength*this.intensity;h.vx+=a*f*.5,h.vy+=c*f*.5,h.disturbed=!0,h.disturbTime=0}})}}class _{constructor(){this.active=!1,this.idleTime=0,this.idleThreshold=6e4,this.driftStrength=0,this.maxDrift=.5}recordActivity(){this.idleTime=0,this.driftStrength=Math.max(0,this.driftStrength-.01)}update(t,s,e,r){if(!this.active){this.driftStrength=0;return}this.idleTime+=s,this.idleTime>this.idleThreshold&&(this.driftStrength=Math.min(this.maxDrift,this.driftStrength+s*1e-5)),!(this.driftStrength<.01)&&t.forEach(a=>{if(Math.random()<.01*this.driftStrength){const c=Math.random()*Math.PI*2,o=Math.random()*e*this.driftStrength*2;a.targetX=a.col*e+Math.cos(c)*o,a.targetY=a.row*r+Math.sin(c)*o}})}}class K{constructor(){this.active=!1,this.intensity=1,this.mouseX=0,this.mouseY=0,this.radius=120,this.attract=!0}setMousePosition(t,s){this.mouseX=t,this.mouseY=s}togglePolarity(){this.attract=!this.attract}update(t,s,e,r){if(!this.active)return;const a=this.radius*this.intensity,c=.15*this.intensity,o=this.attract?-1:1;t.forEach(h=>{const d=h.col*e+e/2,l=h.row*r+r/2,u=d-this.mouseX,f=l-this.mouseY,g=Math.sqrt(u*u+f*f);if(g<a&&g>5){const p=(1-g/a)**2*c,w=Math.atan2(f,u),v=Math.cos(w)*p*o*e,y=Math.sin(w)*p*o*r;h.targetX=h.col*e+v,h.targetY=h.row*r+y,h.disturbed=!0,h.disturbTime=0}else h.disturbed||(h.targetX=h.col*e,h.targetY=h.row*r)})}}class Z{constructor(){this.active=!1,this.intensity=1,this.mouseX=0,this.mouseY=0,this.prevMouseX=0,this.prevMouseY=0,this.windX=0,this.windY=0,this.decay=.95}setMousePosition(t,s){this.prevMouseX=this.mouseX,this.prevMouseY=this.mouseY,this.mouseX=t,this.mouseY=s;const e=t-this.prevMouseX,r=s-this.prevMouseY;this.windX+=e*.1,this.windY+=r*.1;const a=5,c=Math.sqrt(this.windX**2+this.windY**2);c>a&&(this.windX=this.windX/c*a,this.windY=this.windY/c*a)}update(t,s,e,r){if(!this.active){this.windX=0,this.windY=0;return}this.windX*=this.decay,this.windY*=this.decay;const a=Math.sqrt(this.windX**2+this.windY**2);if(a<.1)return;const c=.3*this.intensity;t.forEach(o=>{const h=Math.sin(o.col*.3+o.row*.2)*.3,d=this.windX*c*(1+h),l=this.windY*c*(1+h);o.targetX=o.col*e+d*e,o.targetY=o.row*r+l*r,a>.5&&(o.disturbed=!0,o.disturbTime=0)})}}class J{constructor(){this.state={hasHovered:!1,hasClicked:!1,hasDragged:!1,completed:!1},this.onComplete=null}recordHover(){this.state.hasHovered||(this.state.hasHovered=!0,this.checkComplete())}recordClick(){this.state.hasClicked||(this.state.hasClicked=!0,this.checkComplete())}recordDrag(){this.state.hasDragged||(this.state.hasDragged=!0,this.checkComplete())}checkComplete(){this.state.hasHovered&&this.state.hasClicked&&this.state.hasDragged&&(this.state.completed=!0,this.onComplete&&this.onComplete())}getNextHint(){return this.state.hasHovered?this.state.hasClicked?this.state.hasDragged?null:"drag across the canvas":"try clicking":"move your cursor over the art"}}class tt{constructor(){this.element=document.createElement("div"),this.element.className="hint",this.element.style.opacity="0",document.getElementById("app").appendChild(this.element),this.currentHint=null,this.hideTimeout=null}show(t){t!==this.currentHint&&(this.currentHint=t,this.element.textContent=t,this.element.style.opacity="1",clearTimeout(this.hideTimeout),this.hideTimeout=setTimeout(()=>this.hide(),4e3))}hide(){this.element.style.opacity="0",this.currentHint=null}destroy(){this.element.remove()}}class et{constructor(){this.element=document.createElement("div"),this.element.className="mode-selector",this.element.innerHTML=`
      <div class="modes">
        <span class="mode" data-mode="ripple">Ripple</span>
        <span class="mode" data-mode="magnetic">Magnetic</span>
        <span class="mode active" data-mode="wind">Wind</span>
        <span class="mode" data-mode="glitch">Glitch</span>
        <span class="mode" data-mode="smear">Smear</span>
        <span class="mode" data-mode="chaos">Chaos</span>
      </div>
      <div class="toggles">
        <span class="toggle active" data-toggle="sound">Sound</span>
        <span class="toggle active" data-toggle="color">Color</span>
        <span class="toggle active" data-toggle="drift">Drift</span>
        <span class="toggle active" data-toggle="charset">Unicode</span>
      </div>
    `,this.element.style.opacity="0",this.element.style.pointerEvents="none",document.getElementById("app").appendChild(this.element),this.currentMode="wind",this.toggles={sound:!0,color:!0,drift:!0,charset:!0},this.onModeChange=null,this.onToggleChange=null,this.bindEvents()}bindEvents(){this.element.querySelectorAll(".mode").forEach(t=>{t.addEventListener("click",()=>{this.setMode(t.dataset.mode)})}),this.element.querySelectorAll(".toggle").forEach(t=>{t.addEventListener("click",()=>{this.setToggle(t.dataset.toggle,!this.toggles[t.dataset.toggle])})})}setMode(t){this.currentMode=t,this.element.querySelectorAll(".mode").forEach(s=>{s.classList.toggle("active",s.dataset.mode===t)}),this.onModeChange&&this.onModeChange(t)}setToggle(t,s){this.toggles[t]=s;const e=this.element.querySelector(`[data-toggle="${t}"]`);t==="charset"?(e.textContent=s?"Unicode":"ASCII",e.classList.add("active")):e.classList.toggle("active",s),this.onToggleChange&&this.onToggleChange(t,s)}show(){this.element.style.opacity="1",this.element.style.pointerEvents="auto"}hide(){this.element.style.opacity="0",this.element.style.pointerEvents="none"}}class it{constructor(){this.ctx=null,this.masterGain=null,this.reverbGain=null,this.enabled=!1,this.initialized=!1,this.lastRippleTime=0,this.lastSmearTime=0}async init(){if(this.initialized)return;this.ctx=new(window.AudioContext||window.webkitAudioContext),this.masterGain=this.ctx.createGain(),this.masterGain.gain.value=0,this.reverbGain=this.ctx.createGain(),this.reverbGain.gain.value=.3;const t=this.ctx.createDelay();t.delayTime.value=.1;const s=this.ctx.createDelay();s.delayTime.value=.2;const e=this.ctx.createBiquadFilter();e.type="lowpass",e.frequency.value=2e3,this.reverbGain.connect(t),t.connect(e),e.connect(s),s.connect(this.masterGain),this.masterGain.connect(this.ctx.destination),this.initialized=!0}enable(){this.initialized||this.init(),this.enabled=!0,this.masterGain.gain.linearRampToValueAtTime(.4,this.ctx.currentTime+2)}disable(){this.enabled=!1,this.masterGain&&this.masterGain.gain.linearRampToValueAtTime(0,this.ctx.currentTime+.5)}playRipple(t){if(!this.enabled||!this.ctx)return;const s=performance.now();if(s-this.lastRippleTime<80)return;this.lastRippleTime=s;const e=180+t*1.5,r=[1,1.5,2,3],a=[.06,.03,.02,.01];r.forEach((c,o)=>{const h=this.ctx.createOscillator(),d=this.ctx.createGain(),l=this.ctx.createBiquadFilter();h.type="sine",h.frequency.value=e*c,h.frequency.linearRampToValueAtTime(e*c*.8,this.ctx.currentTime+.4),l.type="lowpass",l.frequency.value=1500-t*3,l.Q.value=2,d.gain.value=a[o],d.gain.exponentialRampToValueAtTime(1e-4,this.ctx.currentTime+.4),h.connect(l),l.connect(d),d.connect(this.masterGain),d.connect(this.reverbGain),h.start(),h.stop(this.ctx.currentTime+.4)})}playGlitch(){if(!this.enabled||!this.ctx)return;const t=this.ctx.sampleRate*.15,s=this.ctx.createBuffer(1,t,this.ctx.sampleRate),e=s.getChannelData(0);for(let l=0;l<t;l++){const u=l/this.ctx.sampleRate,f=Math.random()*2-1,g=Math.round(f*8)/8;e[l]=(f*.3+g*.2)*Math.exp(-u*15)}const r=this.ctx.createBufferSource(),a=this.ctx.createGain(),c=this.ctx.createBiquadFilter(),o=this.ctx.createBiquadFilter();r.buffer=s,c.type="lowpass",c.frequency.value=3e3,c.Q.value=3,o.type="highpass",o.frequency.value=200,a.gain.value=.2,a.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.15),r.connect(o),o.connect(c),c.connect(a),a.connect(this.masterGain),a.connect(this.reverbGain),r.start();const h=this.ctx.createOscillator(),d=this.ctx.createGain();h.type="square",h.frequency.value=80,h.frequency.exponentialRampToValueAtTime(40,this.ctx.currentTime+.05),d.gain.value=.08,d.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.05),h.connect(d),d.connect(this.masterGain),h.start(),h.stop(this.ctx.currentTime+.05)}playSmear(t,s){if(!this.enabled||!this.ctx)return;const e=performance.now();if(e-this.lastSmearTime<50)return;this.lastSmearTime=e;const r=Math.sqrt(t*t+s*s);if(r<2)return;const a=this.ctx.createOscillator(),c=this.ctx.createOscillator(),o=this.ctx.createGain(),h=this.ctx.createBiquadFilter(),d=120+Math.abs(s)*2;a.type="triangle",a.frequency.value=d,a.frequency.linearRampToValueAtTime(d+t*.3,this.ctx.currentTime+.25),c.type="sine",c.frequency.value=d*1.5,c.frequency.linearRampToValueAtTime(d*1.5+t*.2,this.ctx.currentTime+.25),h.type="lowpass",h.frequency.value=800+r*20,h.Q.value=4,o.gain.value=.06,o.gain.linearRampToValueAtTime(.08,this.ctx.currentTime+.05),o.gain.exponentialRampToValueAtTime(.001,this.ctx.currentTime+.25);const l=this.ctx.createGain();l.gain.value=.5,a.connect(h),c.connect(l),l.connect(h),h.connect(o),o.connect(this.masterGain),o.connect(this.reverbGain),a.start(),c.start(),a.stop(this.ctx.currentTime+.25),c.stop(this.ctx.currentTime+.25)}}class st{constructor(){this.element=document.createElement("div"),this.element.className="export-menu",this.element.innerHTML=`
      <div class="export-option" data-format="png">Save as PNG</div>
      <div class="export-option" data-format="txt">Save as Text</div>
    `,document.getElementById("app").appendChild(this.element),this.visible=!1,this.onExport=null,this.bindEvents()}bindEvents(){this.element.querySelectorAll(".export-option").forEach(t=>{t.addEventListener("click",()=>{const s=t.dataset.format;this.hide(),this.onExport&&this.onExport(s)})}),document.addEventListener("click",t=>{this.visible&&!this.element.contains(t.target)&&t.target.id!=="save-btn"&&this.hide()})}toggle(){this.visible?this.hide():this.show()}show(){this.visible=!0,this.element.classList.add("visible")}hide(){this.visible=!1,this.element.classList.remove("visible")}}class rt{constructor(){this.images=[],this.currentIndex=0,this.maxImages=8,this.transitioning=!1,this.onNavigate=null}get count(){return this.images.length}get current(){return this.images[this.currentIndex]||null}add(t,s){return this.images.length>=this.maxImages&&(this.images.shift(),this.currentIndex>0&&this.currentIndex--),this.images.push({asciiData:t,originalFile:s}),this.currentIndex=this.images.length-1,this.currentIndex}clear(){this.images=[],this.currentIndex=0}navigate(t){if(this.transitioning||this.images.length<=1)return!1;const s=t==="next"?(this.currentIndex+1)%this.images.length:(this.currentIndex-1+this.images.length)%this.images.length;if(s===this.currentIndex)return!1;const e=this.currentIndex;return this.currentIndex=s,this.onNavigate&&this.onNavigate(e,s,t),!0}goTo(t){if(this.transitioning||t<0||t>=this.images.length||t===this.currentIndex)return!1;const s=t>this.currentIndex?"next":"prev",e=this.currentIndex;return this.currentIndex=t,this.onNavigate&&this.onNavigate(e,t,s),!0}}class nt{constructor(){this.element=document.createElement("div"),this.element.className="carousel",this.element.innerHTML=`
      <div class="carousel-dots"></div>
      <div class="carousel-nav">
        <span class="carousel-arrow prev">&lt;</span>
        <span class="carousel-counter">1/1</span>
        <span class="carousel-arrow next">&gt;</span>
      </div>
    `,this.element.style.display="none",document.getElementById("app").appendChild(this.element),this.dotsContainer=this.element.querySelector(".carousel-dots"),this.counter=this.element.querySelector(".carousel-counter"),this.prevArrow=this.element.querySelector(".carousel-arrow.prev"),this.nextArrow=this.element.querySelector(".carousel-arrow.next"),this.count=0,this.currentIndex=0,this.onNavigate=null,this.bindEvents()}bindEvents(){this.prevArrow.addEventListener("click",()=>{this.onNavigate&&this.onNavigate("prev")}),this.nextArrow.addEventListener("click",()=>{this.onNavigate&&this.onNavigate("next")}),document.addEventListener("keydown",t=>{this.count<=1||(t.key==="ArrowLeft"?(t.preventDefault(),this.onNavigate&&this.onNavigate("prev")):t.key==="ArrowRight"&&(t.preventDefault(),this.onNavigate&&this.onNavigate("next")))})}update(t,s){if(this.currentIndex=t,this.count=s,s<=1){this.element.style.display="none";return}this.element.style.display="flex",this.counter.textContent=`${t+1}/${s}`,this.dotsContainer.innerHTML="";for(let e=0;e<s;e++){const r=document.createElement("span");r.className="carousel-dot"+(e===t?" active":""),r.addEventListener("click",()=>{this.onNavigate&&e!==this.currentIndex&&this.onNavigate(e>this.currentIndex?"next":"prev",e)}),this.dotsContainer.appendChild(r)}}hide(){this.element.style.display="none"}show(){this.count>1&&(this.element.style.display="flex")}}class at{constructor(){this.transitioning=!1,this.onComplete=null}transition(t,s,e,r,a){if(this.transitioning)return;this.transitioning=!0;const c=t.cols,o=20,h=r==="next"?Array.from({length:c},(l,u)=>u):Array.from({length:c},(l,u)=>c-1-u);let d=0;h.forEach((l,u)=>{const f=u*o;setTimeout(()=>{t.characters.forEach((g,p)=>{if(g.col!==l)return;const w=g.row,v=e.characters[w*c+l];if(!v)return;const y=100,M=g.opacity,C=D=>{const S=Math.min(D/y,1);if(g.opacity=M*(1-S),S<1)requestAnimationFrame(()=>C(D+16));else{g.char=v.char,g.originalChar=v.char,g.weight=v.weight,g.originalColor=v.originalColor;const X=R=>{const Y=Math.min(R/y,1);g.opacity=Y,Y<1&&requestAnimationFrame(()=>X(R+16))};X(0)}};C(0)}),d++,d===c&&setTimeout(()=>{this.transitioning=!1,a&&a()},200)},f)})}}const m=document.getElementById("canvas"),T=document.getElementById("upload"),ct=document.getElementById("upload-btn"),q=document.getElementById("save-btn"),i={renderer:new V(m),lastTime:0,running:!1,effects:{breathing:new j,ripple:new W,magnetic:new K,wind:new Z,glitch:new $,smear:new Q,drift:new _},discovery:new J,hints:new tt,modeSelector:new et,sound:new it,exportMenu:new st,gallery:new rt,carousel:new nt,waveReveal:new at};i.discovery.onComplete=()=>{i.hints.hide(),i.modeSelector.show()};i.modeSelector.onModeChange=n=>{i.effects.ripple.active=!1,i.effects.magnetic.active=!1,i.effects.wind.active=!1,i.effects.glitch.active=!1,i.effects.smear.active=!1,i.effects.ripple.intensity=1,i.effects.magnetic.intensity=1,i.effects.wind.intensity=1,i.effects.glitch.intensity=1,i.effects.smear.intensity=1,(n==="ripple"||n==="chaos")&&(i.effects.ripple.active=!0),n==="magnetic"&&(i.effects.magnetic.active=!0),n==="wind"&&(i.effects.wind.active=!0),(n==="glitch"||n==="chaos")&&(i.effects.glitch.active=!0),(n==="smear"||n==="chaos")&&(i.effects.smear.active=!0),n==="chaos"&&(i.effects.ripple.intensity=.5,i.effects.glitch.intensity=.6,i.effects.smear.intensity=.5),i.renderer.characters.length>0&&i.renderer.pulse()};i.modeSelector.onToggleChange=(n,t)=>{n==="color"&&(i.renderer.colorMode=t),n==="sound"&&(t?i.sound.enable():i.sound.disable()),n==="drift"&&(i.effects.drift.active=t),n==="charset"&&(B(H(t?"unicode":"ascii")),i.renderer.transitionCharset(t))};i.exportMenu.onExport=n=>{n==="png"?i.renderer.exportAsPNG():n==="txt"&&i.renderer.exportAsText()};i.gallery.onNavigate=(n,t,s)=>{const e=i.gallery.images[t].asciiData;if(i.gallery.transitioning=!0,e.cols!==i.renderer.cols||e.rows!==i.renderer.rows){i.renderer.setAsciiData(e),b(),i.gallery.transitioning=!1,i.carousel.update(t,i.gallery.count);return}i.waveReveal.transition(i.renderer,null,e,s,()=>{i.gallery.transitioning=!1,i.carousel.update(t,i.gallery.count)})};i.carousel.onNavigate=(n,t)=>{t!==void 0?i.gallery.goTo(t):i.gallery.navigate(n)};i.renderer.colorMode=!0;i.sound.enable();i.effects.drift.active=!0;i.effects.wind.active=!0;function b(){const n=window.innerWidth*.85,t=window.innerHeight*.85,s=i.renderer.cols>0?i.renderer.cols*10/(i.renderer.rows*18):4/3;let e=n,r=e/s;r>t&&(r=t,e=r*s),i.renderer.resize(e,r)}function L(n){if(!i.running)return;const t=n-i.lastTime;if(i.lastTime=n,i.effects.breathing.update(i.renderer.characters,t),i.effects.ripple.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight),i.effects.magnetic.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight),i.effects.wind.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight),i.effects.glitch.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight,n),i.effects.smear.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight),i.effects.drift.update(i.renderer.characters,t,i.renderer.charWidth,i.renderer.charHeight),!i.discovery.state.completed){const s=i.discovery.getNextHint();s&&i.hints.show(s)}i.renderer.update(t),i.renderer.draw(),requestAnimationFrame(L)}async function G(n,t=!1){try{t&&i.gallery.clear();const s=await U(n),e=F(s,100);i.gallery.add(e,n),i.gallery.count===1||t||e.cols!==i.renderer.cols||e.rows!==i.renderer.rows?(i.renderer.setAsciiData(e),b()):(i.gallery.transitioning=!0,i.waveReveal.transition(i.renderer,null,e,"next",()=>{i.gallery.transitioning=!1})),i.carousel.update(i.gallery.currentIndex,i.gallery.count),q.style.display="block",i.running||(i.running=!0,i.lastTime=performance.now(),requestAnimationFrame(L))}catch(s){console.error("Failed to process image:",s)}}m.addEventListener("mousemove",n=>{const t=m.getBoundingClientRect(),s=n.clientX-t.left,e=n.clientY-t.top;if(i.effects.ripple.setMousePosition(s,e),i.effects.magnetic.setMousePosition(s,e),i.effects.wind.setMousePosition(s,e),i.effects.smear.moveDrag(s,e),i.discovery.recordHover(),i.effects.drift.recordActivity(),i.effects.ripple.active&&i.effects.ripple.mouseSpeed>5&&i.sound.playRipple(i.effects.ripple.mouseSpeed),i.effects.smear.isDragging){const r=i.effects.smear.dragX-i.effects.smear.prevDragX,a=i.effects.smear.dragY-i.effects.smear.prevDragY;i.sound.playSmear(r,a)}});m.addEventListener("mousedown",n=>{const t=m.getBoundingClientRect(),s=n.clientX-t.left,e=n.clientY-t.top;i.effects.smear.startDrag(s,e),i.discovery.recordDrag()});m.addEventListener("mouseup",()=>{i.effects.smear.endDrag()});m.addEventListener("mouseleave",()=>{i.effects.smear.endDrag()});m.addEventListener("click",n=>{const t=m.getBoundingClientRect(),s=n.clientX-t.left,e=n.clientY-t.top;i.effects.glitch.trigger(s,e),i.sound.playGlitch(),i.discovery.recordClick(),i.effects.drift.recordActivity()});m.addEventListener("touchstart",n=>{n.preventDefault();const t=n.touches[0],s=m.getBoundingClientRect(),e=t.clientX-s.left,r=t.clientY-s.top;i.effects.smear.startDrag(e,r),i.effects.ripple.setMousePosition(e,r),i.effects.magnetic.setMousePosition(e,r),i.effects.wind.setMousePosition(e,r),i.discovery.recordHover()});m.addEventListener("touchmove",n=>{n.preventDefault();const t=n.touches[0],s=m.getBoundingClientRect(),e=t.clientX-s.left,r=t.clientY-s.top;i.effects.ripple.setMousePosition(e,r),i.effects.magnetic.setMousePosition(e,r),i.effects.wind.setMousePosition(e,r),i.effects.smear.moveDrag(e,r),i.effects.drift.recordActivity(),i.discovery.recordDrag()});m.addEventListener("touchend",n=>{if(n.preventDefault(),i.effects.smear.endDrag(),n.changedTouches.length===1){const t=n.changedTouches[0],s=m.getBoundingClientRect(),e=t.clientX-s.left,r=t.clientY-s.top;i.effects.glitch.trigger(e,r),i.sound.playGlitch(),i.discovery.recordClick()}});ct.addEventListener("click",n=>{T.shiftHeld=n.shiftKey,T.click()});q.addEventListener("click",()=>i.exportMenu.toggle());T.addEventListener("change",n=>{const t=n.target.files[0];t&&(G(t,T.shiftHeld),T.shiftHeld=!1)});window.addEventListener("resize",b);b();console.log("ASCII Art Installation ready");let N=0;m.addEventListener("touchstart",n=>{N=n.touches[0].clientX},{passive:!0});m.addEventListener("touchend",n=>{if(i.gallery.count<=1)return;const s=n.changedTouches[0].clientX-N;Math.abs(s)>50&&(s>0?i.gallery.navigate("prev"):i.gallery.navigate("next"))},{passive:!0});async function ot(){try{const n=await fetch("/example.jpg");if(!n.ok)throw new Error("No example image");const t=await n.blob(),s=new File([t],"example.jpg",{type:"image/jpeg"});await G(s)}catch{console.log("No example image found, waiting for upload")}}ot();
